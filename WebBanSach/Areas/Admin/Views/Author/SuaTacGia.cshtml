@model Media.Models.TacGia
@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Sửa Tác Giả";
}

<div class="min-h-screen bg-gray-50/50 dark:bg-gray-900/50 py-6">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                        <i class='bx bx-edit text-2xl text-blue-600 dark:text-blue-400'></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Sửa Thông Tin Tác Giả</h1>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Cập nhật thông tin tác giả trong hệ thống</p>
                    </div>
                </div>
                <a href="@Url.Action("QuanLyTacGia", "Author", new { area = "Admin" })"
                   class="inline-flex items-center px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-600 text-gray-700 dark:text-gray-300 rounded-xl transition-all duration-200 hover:shadow-md">
                    <i class='bx bx-arrow-back mr-2'></i>
                    Quay lại danh sách
                </a>
            </div>
        </div>

        <!-- Thông báo -->
        @if (TempData["Success"] != null)
        {
            <div class="mb-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class='bx bx-check-circle text-green-500 text-xl'></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-green-800 dark:text-green-300 font-medium">@TempData["Success"]</p>
                    </div>
                </div>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class='bx bx-error-circle text-red-500 text-xl'></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-red-800 dark:text-red-300 font-medium">@TempData["Error"]</p>
                    </div>
                </div>
            </div>
        }

        <!-- Main Form Card -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">

            <!-- Card Header với gradient -->
            <div class="px-8 py-6 bg-gradient-to-r from-blue-500 to-indigo-600 dark:from-blue-600 dark:to-indigo-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-white/20 rounded-lg backdrop-blur-sm">
                            <i class='bx bx-edit text-2xl text-white'></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-white">Thông tin tác giả</h2>
                            <p class="text-blue-100 text-sm mt-1">Cập nhật thông tin tác giả ID: @Model.MaTacGia</p>
                        </div>
                    </div>
                    <div class="hidden sm:block">
                        <span class="bg-white/20 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm">Bắt buộc *</span>
                    </div>
                </div>
            </div>

            <!-- Card Body -->
            <div class="p-8">
                <form method="post" asp-action="SuaTacGia" asp-controller="Author" asp-area="Admin" id="editForm">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="MaTacGia" />

                    <!-- Tên tác giả -->
                    <div class="mb-6 group">
                        <div class="flex items-center justify-between mb-3">
                            <label asp-for="TenTG" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                <i class='bx bx-user text-lg text-blue-500'></i>
                                Tên tác giả
                                <span class="text-red-500 text-lg">*</span>
                            </label>
                            <span class="text-xs text-gray-500 dark:text-gray-400" id="tenTGCount">@(Model.TenTG?.Length ?? 0)/100</span>
                        </div>
                        <input asp-for="TenTG"
                               class="w-full px-4 py-4 border-2 border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-blue-500 dark:focus:border-blue-600 focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900/30 transition-all duration-300"
                               placeholder="Nhập tên tác giả"
                               maxlength="100" />
                        <div class="flex items-center justify-between mt-2">
                            <span asp-validation-for="TenTG" class="text-red-600 dark:text-red-400 text-sm"></span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Tối đa 100 ký tự</span>
                        </div>
                    </div>

                    <!-- Quốc tịch -->
                    <div class="mb-6 group">
                        <div class="flex items-center justify-between mb-3">
                            <label asp-for="QuocTich" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                <i class='bx bx-flag text-lg text-green-500'></i>
                                Quốc tịch
                            </label>
                            <span class="text-xs text-gray-500 dark:text-gray-400" id="quocTichCount">@(Model.QuocTich?.Length ?? 0)/50</span>
                        </div>
                        <input asp-for="QuocTich"
                               class="w-full px-4 py-4 border-2 border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-green-500 dark:focus:border-green-600 focus:ring-4 focus:ring-green-100 dark:focus:ring-green-900/30 transition-all duration-300"
                               placeholder="Nhập quốc tịch"
                               maxlength="50" />
                        <div class="flex items-center justify-between mt-2">
                            <span asp-validation-for="QuocTich" class="text-red-600 dark:text-red-400 text-sm"></span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Tối đa 50 ký tự</span>
                        </div>
                    </div>

                    <!-- Tiểu sử -->
                    <div class="mb-6 group">
                        <div class="flex items-center justify-between mb-3">
                            <label asp-for="TieuSu" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                <i class='bx bx-book-open text-lg text-purple-500'></i>
                                Tiểu sử
                            </label>
                            <span class="text-xs text-gray-500 dark:text-gray-400" id="tieuSuCount">@(Model.TieuSu?.Length ?? 0)/1000</span>
                        </div>
                        <textarea asp-for="TieuSu"
                                  rows="6"
                                  class="w-full px-4 py-4 border-2 border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:border-purple-500 dark:focus:border-purple-600 focus:ring-4 focus:ring-purple-100 dark:focus:ring-purple-900/30 transition-all duration-300 resize-vertical leading-relaxed"
                                  placeholder="Mô tả chi tiết về tác giả..."
                                  maxlength="1000"></textarea>
                        <div class="flex items-center justify-between mt-2">
                            <span asp-validation-for="TieuSu" class="text-red-600 dark:text-red-400 text-sm"></span>
                            <span class="text-xs text-gray-500 dark:text-gray-400">Tối đa 1000 ký tự</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-8 border-t border-gray-200 dark:border-gray-700">
                        <button type="submit"
                                id="submitBtn"
                                class="flex-1 inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold rounded-xl transition-all duration-300 hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-200 dark:focus:ring-blue-900/30">
                            <i class='bx bx-save text-xl mr-3'></i>
                            <span class="btn-text">Cập nhật Tác Giả</span>
                            <i class='bx bx-loader-alt animate-spin ml-3 hidden'></i>
                        </button>

                        <button type="reset"
                                class="px-8 py-4 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-600">
                            <i class='bx bx-reset mr-2'></i>
                            Nhập Lại
                        </button>

                        <a href="@Url.Action("QuanLyTacGia", "Author", new { area = "Admin" })"
                           class="px-8 py-4 bg-transparent border-2 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 text-gray-700 dark:text-gray-300 font-semibold rounded-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-600 text-center">
                            <i class='bx bx-x mr-2'></i>
                            Hủy Bỏ
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Info -->
        <div class="mt-8 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-2xl p-6">
            <div class="flex items-start gap-3">
                <i class='bx bx-info-circle text-blue-500 text-xl mt-0.5'></i>
                <div>
                    <h3 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">Thông tin cập nhật</h3>
                    <ul class="text-blue-700 dark:text-blue-400 text-sm space-y-1">
                        <li>• ID tác giả: <span class="font-mono">@Model.MaTacGia</span></li>
                        <li>• Các thay đổi sẽ được lưu ngay lập tức</li>
                        <li>• Tên tác giả không được trùng với các tác giả khác</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('editForm');
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const loaderIcon = submitBtn.querySelector('.bx-loader-alt');

            // Elements for character counting
            const tenTGInput = document.getElementById('TenTG');
            const quocTichInput = document.getElementById('QuocTich');
            const tieuSuTextarea = document.getElementById('TieuSu');

            const tenTGCount = document.getElementById('tenTGCount');
            const quocTichCount = document.getElementById('quocTichCount');
            const tieuSuCount = document.getElementById('tieuSuCount');

            // Character counting function
            function updateCharacterCount(element, counter, maxLength) {
                const length = element.value.length;
                counter.textContent = `${length}/${maxLength}`;

                if (length > maxLength * 0.8) {
                    counter.classList.add('text-orange-500');
                    counter.classList.remove('text-gray-500');
                } else if (length > maxLength) {
                    counter.classList.add('text-red-500');
                    counter.classList.remove('text-orange-500', 'text-gray-500');
                } else {
                    counter.classList.remove('text-orange-500', 'text-red-500');
                    counter.classList.add('text-gray-500');
                }
            }

            // Initialize character counts
            function initializeCharacterCounts() {
                updateCharacterCount(tenTGInput, tenTGCount, 100);
                updateCharacterCount(quocTichInput, quocTichCount, 50);
                updateCharacterCount(tieuSuTextarea, tieuSuCount, 1000);
            }

            // Event listeners for character counting
            tenTGInput.addEventListener('input', () => updateCharacterCount(tenTGInput, tenTGCount, 100));
            quocTichInput.addEventListener('input', () => updateCharacterCount(quocTichInput, quocTichCount, 50));
            tieuSuTextarea.addEventListener('input', () => updateCharacterCount(tieuSuTextarea, tieuSuCount, 1000));

            // Auto-focus on TenTG
            tenTGInput.focus();

            // Form submission handler
            form.addEventListener('submit', function (e) {
                // Basic validation
                const tenTG = tenTGInput.value.trim();
                if (!tenTG) {
                    e.preventDefault();
                    tenTGInput.focus();
                    return;
                }

                // Show loading state
                submitBtn.disabled = true;
                btnText.textContent = 'Đang xử lý...';
                loaderIcon.classList.remove('hidden');
            });

            // Reset form confirmation
            form.addEventListener('reset', function (e) {
                if (!confirm('Bạn có chắc muốn khôi phục giá trị ban đầu?')) {
                    e.preventDefault();
                }
            });

            // Initialize on load
            initializeCharacterCounts();

            console.log("Form sẵn sàng - ID tác giả:", @Model.MaTacGia);
        });
    </script>
}