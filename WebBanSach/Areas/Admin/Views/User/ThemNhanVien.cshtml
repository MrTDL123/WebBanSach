@model Media.Models.NhanVien
@{
    ViewData["Title"] = "Thêm Nhân Viên";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-blue-500 text-white rounded-xl">
                        <i class='bx bx-user-plus text-xl'></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Thêm Nhân Viên Mới</h1>
                        <p class="text-gray-600 dark:text-gray-400">Thêm thông tin nhân viên vào hệ thống</p>
                    </div>
                </div>
                <a href="@Url.Action("QuanLyNguoiDung")"
                   class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <i class='bx bx-arrow-back mr-2'></i>
                    Quay lại
                </a>
            </div>
        </div>

        <!-- Alert Messages -->
        @if (TempData["Success"] != null)
        {
            <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-800 rounded-lg dark:bg-green-900 dark:border-green-700 dark:text-green-300">
                <div class="flex items-center">
                    <i class='bx bx-check-circle text-green-600 dark:text-green-400 mr-3'></i>
                    <div>
                        <strong>Thành công!</strong> @TempData["Success"]
                    </div>
                </div>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-800 rounded-lg dark:bg-red-900 dark:border-red-700 dark:text-red-300">
                <div class="flex items-center">
                    <i class='bx bx-error text-red-600 dark:text-red-400 mr-3'></i>
                    <div>
                        <strong>Lỗi!</strong> @TempData["Error"]
                    </div>
                </div>
            </div>
        }

        <!-- Main Form -->
        <form asp-action="ThemNhanVien" method="post" id="addStaffForm">
            @Html.AntiForgeryToken()

            <div class="space-y-6">
                <!-- Thông tin cá nhân -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class='bx bx-user text-blue-500'></i>
                        Thông tin cá nhân
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Họ tên -->
                        <div class="md:col-span-2">
                            <label asp-for="HoTen" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Họ và tên <span class="text-red-500">*</span>
                            </label>
                            <input asp-for="HoTen"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   placeholder="Nhập họ và tên đầy đủ" required />
                            <span asp-validation-for="HoTen" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                        </div>

                        <!-- Ngày sinh -->
                        <div>
                            <label asp-for="NgaySinh" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Ngày sinh
                            </label>
                            <input asp-for="NgaySinh" type="date"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   max="@DateTime.Today.ToString("yyyy-MM-dd")" />
                            <span asp-validation-for="NgaySinh" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                        </div>

                        <!-- CCCD -->
                        <div>
                            <label asp-for="CCCD" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                CCCD/CMND
                            </label>
                            <input asp-for="CCCD"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   placeholder="Nhập 12 số CCCD"
                                   pattern="[0-9]{12}"
                                   title="CCCD phải có đúng 12 chữ số" />
                            <span asp-validation-for="CCCD" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">12 chữ số, không bao gồm ký tự đặc biệt</p>
                        </div>
                    </div>
                </div>

                <!-- Thông tin liên hệ -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class='bx bx-map text-green-500'></i>
                        Thông tin liên hệ
                    </h2>

                    <div class="space-y-4">
                        <!-- Địa chỉ -->
                        <div>
                            <label asp-for="DiaChi" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Địa chỉ hiện tại
                            </label>
                            <textarea asp-for="DiaChi" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-vertical"
                                      placeholder="Nhập địa chỉ đầy đủ: số nhà, đường, phường/xã, quận/huyện, tỉnh/thành phố"></textarea>
                            <span asp-validation-for="DiaChi" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                        </div>

                        <!-- Quê quán -->
                        <div>
                            <label asp-for="QueQuan" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Quê quán
                            </label>
                            <input asp-for="QueQuan"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   placeholder="Nhập quê quán (tỉnh/thành phố)" />
                            <span asp-validation-for="QueQuan" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                        </div>
                    </div>
                </div>

                <!-- Thông tin công việc -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <i class='bx bx-briefcase text-purple-500'></i>
                        Thông tin công việc
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ngày vào làm -->
                        <div>
                            <label asp-for="NgayVaoLam" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Ngày vào làm <span class="text-red-500">*</span>
                            </label>
                            <input asp-for="NgayVaoLam" type="date"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   required />
                            <span asp-validation-for="NgayVaoLam" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                        </div>

                        <!-- Bậc lương -->
                        <div>
                            <label asp-for="BacLuong" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Bậc lương
                            </label>
                            <input asp-for="BacLuong" type="number"
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                   placeholder="1-15" min="1" max="15" />
                            <span asp-validation-for="BacLuong" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Từ bậc 1 đến 15</p>
                        </div>

                        <!-- Lương cơ bản -->
                        <div class="md:col-span-2">
                            <label asp-for="Luong" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Lương cơ bản (VNĐ)
                            </label>
                            <div class="relative">
                                <input asp-for="Luong" type="number" step="100000"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors pr-20"
                                       placeholder="Nhập mức lương" min="0" />
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="text-gray-500 dark:text-gray-400">VNĐ</span>
                                </div>
                            </div>
                            <span asp-validation-for="Luong" class="text-red-600 dark:text-red-400 text-xs mt-1 block"></span>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Lương cơ bản hàng tháng</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 pt-4">
                    <button type="submit" id="submitBtn"
                            class="flex-1 inline-flex items-center justify-center px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        <i class='bx bx-user-plus mr-2'></i>
                        Thêm nhân viên
                    </button>

                    <a href="@Url.Action("QuanLyNguoiDung")"
                       class="flex-1 inline-flex items-center justify-center px-4 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-center transition-colors">
                        <i class='bx bx-x mr-2'></i>
                        Hủy bỏ
                    </a>
                </div>

                <!-- Form Info -->
                <div class="text-center">
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        <i class='bx bx-info-circle mr-1'></i>
                        Các trường có dấu <span class="text-red-500">*</span> là bắt buộc
                    </p>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('addStaffForm');
            const submitBtn = document.getElementById('submitBtn');

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            const ngayVaoLamField = document.querySelector('input[name="NgayVaoLam"]');
            if (ngayVaoLamField && !ngayVaoLamField.value) {
                ngayVaoLamField.value = today;
            }

            // Format CCCD input (only numbers, max 12)
            const cccdField = document.querySelector('input[name="CCCD"]');
            if (cccdField) {
                cccdField.addEventListener('input', function() {
                    this.value = this.value.replace(/\D/g, '').slice(0, 12);
                });
            }

            // Form submission handling
            form.addEventListener('submit', function(e) {
                console.log('Form submitted...');

                const originalHTML = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin mr-2"></i> Đang xử lý...';
                submitBtn.disabled = true;

                // Fallback: re-enable after 10 seconds
                setTimeout(() => {
                    if (submitBtn.disabled) {
                        submitBtn.innerHTML = originalHTML;
                        submitBtn.disabled = false;
                        console.log('Button reset after timeout');
                    }
                }, 10000);
            });

            // Real-time validation feedback
            const inputs = form.querySelectorAll('input[required], textarea[required]');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
            });

            function validateField(field) {
                if (field.checkValidity()) {
                    field.classList.remove('border-red-300');
                    field.classList.add('border-green-300');
                } else {
                    field.classList.remove('border-green-300');
                    field.classList.add('border-red-300');
                }
            }
        });
    </script>

    <style>
        .bx-loader-alt.bx-spin {
            animation: spin 1s linear infinite;
        }

        @@keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>
}