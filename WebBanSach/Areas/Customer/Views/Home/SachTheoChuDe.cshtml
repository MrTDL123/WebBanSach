@model SachTheoChuDeVM
@using X.PagedList
@using X.PagedList.Mvc.Core
@addTagHelper *, X.PagedList.Mvc.Core

@functions{
    public string Truncate(string noidung, int length)
    {
        if (noidung.Length < length)
        {
            return noidung;
        }
        else
        {
            return $"{noidung.Substring(0, length)}...";
        }
    }

    public string HienThiDongGia(decimal giaTien)
    {
        return giaTien.ToString("C0", System.Globalization.CultureInfo.GetCultureInfo("vi-VN"));
    }
}
<div id="sachtheochude_container">
    <p class="montserrat-medium">@ViewBag.Url</p>

    <div id="sachtheochude">
        <section id="sachtheochude_left">
            <section id="same_category_books">
                <p class="sachtheochude_left_title montserrat-bold" id="">CHỦ ĐỀ TƯƠNG ỨNG</p>
                <aside>
                    <a asp-controller="Home" asp-action="LayTatCaSach">Tất cả chủ đề</a>

                    <ul class="chude_item_root">
                        @await Html.PartialAsync("_ChuDeTuongUngPartial", Model.ChuDeHienTai)
                    </ul>

                </aside>
                        
            </section>

            <section id="price_filter">
                <p class="sachtheochude_left_title montserrat-bold" id="">GIÁ</p>
                <form method="get" asp-action="SachTheoChuDe" asp-controller="Home" id="filterForm">
                    @foreach (var range in Model.PriceFilter.PriceRanges)
                    {
                        <div class="form-check mb-2">
                            <input class="form-check-input price-filter"
                                   type="checkbox"
                                   name="priceRanges"
                                   value="@range.Id"
                                   id="@range.Id"
                                   @(Model.PriceFilter.SelectedRanges.Contains(range.Id) ? "checked" : "")>
                            <label class="form-check-label" for="@range.Id">
                                @range.Label
                            </label>
                        </div>
                    }
                </form>
            </section>
            
            <section id="nhaxuatban_filter">
                <p class="sachtheochude_left_title montserrat-bold" id="">NHÀ XUẤT BẢN</p>
            </section>

            <section id="tacgia_filter">
                <p class="sachtheochude_left_title montserrat-bold" id="">TÁC GIẢ</p>
            </section>
        </section>

        
        <section id="sachtheochude_right">
            
        </section>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.price-filter').on('change', function() {
                $('#filterForm').submit();
            });
        });


                // wwwroot/js/filter-with-url.js
        $(document).ready(function() {

            function loadProducts() {
                var selectedPrices = [];
                $('.price-filter:checked').each(function() {
                    selectedPrices.push($(this).val());
                });

                var params = new URLSearchParams();
                selectedPrices.forEach(p => params.append('priceRanges', p));

                // Cập nhật URL mà không reload trang
                history.pushState(null, '', '?' + params.toString());

                $.ajax({
                    url: '/Home/SachTheoChuDe?' + params.toString(),
                    success: function(result) {
                        $('#toolbar-section').html(result.toolbar);
                        $('#product-list').html(result.productList);
                        $('#pagination-section').html(result.pagination);
                    }
                });
            }

            $('.price-filter').on('change', loadProducts);

            // Xử lý nút Back/Forward của browser
            window.addEventListener('popstate', function() {
                location.reload();
            });
        });
    </script>
}

