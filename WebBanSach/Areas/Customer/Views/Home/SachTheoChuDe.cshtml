@model SachTheoChuDeVM
@using X.PagedList
@using X.PagedList.Mvc.Core
@addTagHelper *, X.PagedList.Mvc.Core
@section PageStyles {
    <link rel="stylesheet" href="~/css/pages/khachhang/sachtheochude.css" asp-append-version="true" />
}

@{
    ViewData["Title"] = string.IsNullOrEmpty(Model.SearchKeyword)
        ? "Sách theo chủ đề"
        : $"Kết quả tìm kiếm: {Model.SearchKeyword}";

    // Truyền keyword ra Layout để hiển thị trong search box
    ViewBag.SearchKeyword = Model.SearchKeyword;
}

<div id="sachtheochude_container">
    @await Html.PartialAsync("_BreadcrumbPartial", Model.Breadcrumbs)

    <div id="sachtheochude">
        <section id="sachtheochude_left">
            <form id="filterForm"
                data-sort-by="@Model.SortBy"
                data-page-size="@Model.PageSize"
                data-path="@Model.ChuDeSelected.FullPath">

                <section id="same_category_books" class="filter-section">
                    <p class="sachtheochude_left_title montserrat-bold">CHỦ ĐỀ TƯƠNG ỨNG</p>
                    <aside>
                        <a class="chude-filter" 
                           href="/chude/tat-ca-chu-de"
                           data-path="tat-ca-chu-de">
                            Tất cả chủ đề
                        </a>

                        <ul class="chude_item_root">
                            @await Html.PartialAsync("_ChuDeTuongUngPartial", Model.ChuDeCha)
                        </ul>

                    </aside>
                </section>

                <section id="price_filter" class="filter-section">
                    <p class="sachtheochude_left_title montserrat-bold" id="">GIÁ</p>
                        @foreach (var range in Model.PriceFilter.PriceRanges)
                        {
                            <div class="form-check mb-2">
                                <input class="form-check-input price-filter"
                                       type="checkbox"
                                       name="priceRanges"
                                       value="@range.Id"
                                       id="@range.Id"
                                       @(Model.PriceFilter.SelectedRanges.Contains(range.Id) ? "checked" : "")>
                                <label class="form-check-label" for="@range.Id">
                                    @range.Label
                                </label>
                            </div>
                        }
                </section>

                <section id="nhaxuatban_filter" class="filter-section">
                    @await Html.PartialAsync("_NhaXuatBanFilterPartial", Model.DanhSachNhaXuatBan)
                </section>

                <section id="tacgia_filter" class="filter-section">
                    @await Html.PartialAsync("_TacGiaFilterPartial", Model.DanhSachTacGia)
                </section>
            </form>
        </section>

        
        <section id="sachtheochude_right">
            <div id="toolbar-section">
                @await Html.PartialAsync("_ToolbarPartial", Model)
                @if(!string.IsNullOrEmpty(Model.SearchKeyword))
                {
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-search"></i>
                        Kết quả tìm kiếm cho: <strong>"@Model.SearchKeyword"</strong>
                        <span class="ms-2">(@Model.DanhSachSach.TotalItemCount sản phẩm)</span>
                    </div>
                }
            </div>
            <div id="sach-list-section">
                @await Html.PartialAsync("_SachListPartial", Model)
            </div>
            <div id="pagination-section">
                @await Html.PartialAsync("_PaginationPartial", Model.DanhSachSach)
            </div>
        </section>
    </div>

</div>

@section Scripts {
    <script src="~/js/filtered_saches.js"></script>
    <script>
        $(document).ready(function () {
            $('.direct_cart_icon').click(function () {
                var maSach = $(this).data('masach');

                $.ajax({
                    url: '/Customer/GioHang/ThemVaoGioHang',
                    type: 'POST',
                    data: { maSach: maSach, soLuong : 1 },
                    success: function (res) {
                        if (res.success) {
                            $('#cart-count').text(`(${res.count})`);
                        }
                    }
                });
            });
        });
    </script>
}